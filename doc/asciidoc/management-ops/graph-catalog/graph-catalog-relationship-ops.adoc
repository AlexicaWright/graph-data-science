[[graph-catalog-relationship-ops]]
= Relationship operations

[abstract]
--
This section details the operations available over relationships and relationship properties stored in projected graphs within the Neo4j Graph Data Science library.
--

The graphs in the Neo4j Graph Data Science Library support properties for relationships.
We provide multiple operations to work with the stored relationship-properties in projected graphs.
Relationship properties are either created during the graph creation or when using the `mutate` mode of our graph algorithms.

To inspect stored relationship property values, the `streamRelationshipProperties` procedure can be used.
This is useful if we ran multiple algorithms in `mutate` mode and want to retrieve some or all of the results.

To persist relationship types in a Neo4j database, we can use `gds.graph.writeRelationship`.
Similar to streaming relationship properties, it is also possible to write back to Neo4j.
This is similar to what an algorithm `write` execution mode does, but allows more fine-grained control over the operations.
By default, no relationship properties will be written. To write relationship properties, these have to be explicitly specified.

We can also remove relationships from a named graph in the catalog.
This is useful to free up main memory or to remove accidentally created relationship types.

== Syntax

.Syntax descriptions of the different operations over relationship types
[.tabbed-example, caption=]
====

[.include-with-stream-single-property]
======
[source, cypher, role=noplay]
----
CALL gds.graph.streamRelationshipProperty(
    graphName: String,
    relationshipProperties: List of String,
    relationshipTypes: List of Strings,
    configuration: Map
)
YIELD
    sourceNodeId: Integer,
    targetNodeId: Integer,
    relationshipType: String,
    propertyValue: Integer or Float
----

.Parameters
[opts="header",cols="1,3,1,5"]
|===
| Name                   | Type                       | Optional | Description
| graphName              | String                     | no       | The name under which the graph is stored in the catalog.
| relationshipProperties | List of String             | no       | The relationship properties in the graph to stream.
| relationshipTypes      | List of Strings            | yes      | The relationship types to stream the relationship properties for graph.
| configuration          | Map                        | yes      | Additional parameters to configure streamNodeProperties.
|===

.Configuration
[opts="header",cols="1,1,1,7"]
|===
| Name                   | Type                  | Default | Description
| concurrency            | Integer               | 4       | The number of concurrent threads. Note, this procedure is always running single-threaded.
|===

.Results
[opts="header",cols="2,3,5"]
|===
| Name                  | Type                                                 | Description
| sourceNodeId          | Integer                                              | The id of the source node for the relationship.
| targetNodeId          | Integer                                              | The id of the target node for the relationship.
| relationshipType      | Integer                                              | The type of the relationship.
.^| propertyValue
a|
* Integer
* Float
.^| The stored property value.
|===
======

[.include-with-stream]
======
[source, cypher, role=noplay]
----
CALL gds.graph.streamRelationshipProperties(
    graphName: String,
    relationshipProperties: List of String,
    relationshipTypes: List of Strings,
    configuration: Map
)
YIELD
    sourceNodeId: Integer,
    targetNodeId: Integer,
    relationshipType: String,
    relationshipProperty: String,
    propertyValue: Integer or Float
----

.Parameters
[opts="header",cols="1,3,1,5"]
|===
| Name                   | Type                       | Optional | Description
| graphName              | String                     | no       | The name under which the graph is stored in the catalog.
| relationshipProperties | List of String             | no       | The relationship properties in the graph to stream.
| relationshipTypes      | List of Strings            | yes      | The relationship types to stream the relationship properties for graph.
| configuration          | Map                        | yes      | Additional parameters to configure streamNodeProperties.
|===

.Configuration
[opts="header",cols="1,1,1,7"]
|===
| Name                   | Type                  | Default | Description
| concurrency            | Integer               | 4       | The number of concurrent threads. Note, this procedure is always running single-threaded.
|===

.Results
[opts="header",cols="2,3,5"]
|===
| Name                  | Type                                                 | Description
| sourceNodeId          | Integer                                              | The id of the source node for the relationship.
| targetNodeId          | Integer                                              | The id of the target node for the relationship.
| relationshipType      | Integer                                              | The type of the relationship.
| relationshipProperty  | Integer                                              | The name of the relationship property.
.^| propertyValue
a|
* Integer
* Float
.^| The stored property value.
|===
======

[.include-with-write]
======
[source, cypher, role=noplay]
----
CALL gds.graph.writeRelationship(
    graphName: String,
    relationshipType: String,
    relationshipProperty: String,
    configuration: Map
)
YIELD
  writeMillis: Integer,
  graphName: String,
  relationshipType: String,
  relationshipsWritten: Integer,
  relationshipProperty: String,
  propertiesWritten: Integer
----

.Parameters
[opts="header",cols="1,3,1,5"]
|===
| Name                  | Type    | Optional | Description
| graphName             | String  | no       | The name under which the graph is stored in the catalog.
| relationshipType      | String  | no       | The relationship type in the graph to write back.
| relationshipProperty  | String  | yes      | The relationship property to write back.
| configuration         | Map     | yes      | Additional parameters to configure writeRelationship.
|===

.Configuration
[opts="header",cols="1,1,1,7"]
|===
| Name                   | Type                  | Default           | Description
| concurrency            | Integer               | 4                 | The number of concurrent threads used for running the procedure. Also provides the default value for `writeConcurrency`
| writeConcurrency       | Integer               | 'concurrency'     | The number of concurrent threads used for writing the node properties.
|===

.Results
[opts="header",cols="2,3,5"]
|===
| Name                  | Type                     | Description
| writeMillis           | Integer                  | Milliseconds for writing result data back to Neo4j.
| graphName             | String                   | The name of a graph stored in the catalog.
| relationshipType      | String                   | The type of the relationship that was written.
| relationshipsWritten  | Integer                  | Number relationships written.
| relationshipProperty  | String                   | The name of the relationship property that was written.
| propertiesWritten     | Integer                  | Number relationships properties written.
|===
======

[.include-with-delete-relationships]
======
[source, cypher, role=noplay]
----
CALL gds.graph.deleteRelationships(
    graphName: String,
    relationshipType: String
)
YIELD
  graphName: String,
  relationshipType: String,
  deletedRelationships: Integer,
  deletedProperties: Map
----

.Parameters
[opts="header",cols="1,3,1,5"]
|===
| Name             | Type    | Optional | Description
| graphName        | String  | no       | The name under which the graph is stored in the catalog.
| relationshipType | String  | no       | The relationship type in the graph to remove.
|===

.Results
[opts="header",cols="2,3,5"]
|===
| Name                 | Type       | Description
| graphName            | String     | The name of a graph stored in the catalog.
| relationshipType     | String     | The type of the removed relationships.
| deletedRelationships | Integer    | Number of removed relationships from the in-memory graph.
| deletedProperties    | Integer    | Map where the key is the name of the relationship property, and the value is the number of removed properties under that name.
|===
======
====


== Examples

In order to demonstrate the GDS capabilities over node properties, we are going to create a small graph in Neo4j and project it into our graph catalog.

image::example-graphs/node-similarity.svg[Visualization of the example graph,align="center"]

.The following Cypher statement will create the example graph in the Neo4j database:
[source, cypher, role=noplay setup-query]
----
CREATE
  (alice:Person {name: 'Alice'}),
  (bob:Person {name: 'Bob'}),
  (carol:Person {name: 'Carol'}),
  (dave:Person {name: 'Dave'}),
  (eve:Person {name: 'Eve'}),
  (guitar:Instrument {name: 'Guitar'}),
  (synth:Instrument {name: 'Synthesizer'}),
  (bongos:Instrument {name: 'Bongos'}),
  (trumpet:Instrument {name: 'Trumpet'}),

  (alice)-[:LIKES { score: 5 }]->(guitar),
  (alice)-[:LIKES { score: 4 }]->(synth),
  (alice)-[:LIKES { score: 3, strength: 0.5}]->(bongos),
  (bob)-[:LIKES { score: 4 }]->(guitar),
  (bob)-[:LIKES { score: 5 }]->(synth),
  (carol)-[:LIKES { score: 2 }]->(bongos),
  (dave)-[:LIKES { score: 3 }]->(guitar),
  (dave)-[:LIKES { score: 1 }]->(synth),
  (dave)-[:LIKES { score: 5 }]->(bongos)
----

.Project the graph:
[source, cypher, role=noplay graph-create-query]
----
CALL gds.graph.create(
  'personsAndInstruments',
  ['Person', 'Instrument'],
  {
    LIKES: {
      type: 'LIKES',
      properties: {
        strength: {
          property: 'strength',
          defaultValue: 1.0
        },
        score: {
          property: 'score'
        }
      }
    }
  }
)
----

.Compute the Node Similarity in our graph:
[source, cypher, role=noplay graph-create-query]
----
CALL gds.nodeSimilarity.mutate('personsAndInstruments', {
  mutateRelationshipType: 'SIMILAR',
  mutateProperty: 'score'
})
----


=== Stream

==== Single property

[role=query-example]
--
[source, cypher, role=noplay]
----
CALL gds.graph.streamRelationshipProperty('personsAndInstruments', 'score')
YIELD
  sourceNodeId, targetNodeId, relationshipType, propertyValue
RETURN
  gds.util.asNode(sourceNodeId).name as source, gds.util.asNode(targetNodeId).name as target, relationshipType, propertyValue
ORDER BY source ASC, target ASC
----

.Results
[opts="header"]
|===
| source  | target        | relationshipType  | propertyValue
| "Alice" | "Bob"         | "SIMILAR"         | 0.6666666666666666
| "Alice" | "Bongos"      | "LIKES"           | 3.0
| "Alice" | "Carol"       | "SIMILAR"         | 0.3333333333333333
| "Alice" | "Dave"        | "SIMILAR"         | 1.0
| "Alice" | "Guitar"      | "LIKES"           | 5.0
| "Alice" | "Synthesizer" | "LIKES"           | 4.0
| "Bob"   | "Alice"       | "SIMILAR"         | 0.6666666666666666
| "Bob"   | "Dave"        | "SIMILAR"         | 0.6666666666666666
| "Bob"   | "Guitar"      | "LIKES"           | 4.0
| "Bob"   | "Synthesizer" | "LIKES"           | 5.0
| "Carol" | "Alice"       | "SIMILAR"         | 0.3333333333333333
| "Carol" | "Bongos"      | "LIKES"           | 2.0
| "Carol" | "Dave"        | "SIMILAR"         | 0.3333333333333333
| "Dave"  | "Alice"       | "SIMILAR"         | 1.0
| "Dave"  | "Bob"         | "SIMILAR"         | 0.6666666666666666
| "Dave"  | "Bongos"      | "LIKES"           | 5.0
| "Dave"  | "Carol"       | "SIMILAR"         | 0.3333333333333333
| "Dave"  | "Guitar"      | "LIKES"           | 3.0
| "Dave"  | "Synthesizer" | "LIKES"           | 1.0
|===
--

[role=query-example]
--
[source, cypher, role=noplay]
----
CALL gds.graph.streamRelationshipProperty('personsAndInstruments', 'score', ['SIMILAR'])
YIELD
  sourceNodeId, targetNodeId, relationshipType, propertyValue
RETURN
  gds.util.asNode(sourceNodeId).name as source, gds.util.asNode(targetNodeId).name as target, relationshipType, propertyValue
ORDER BY source ASC, target ASC
----

.Results
[opts="header"]
|===
|  source | target  | relationshipType  | propertyValue
| "Alice" | "Bob"   | "SIMILAR"         | 0.6666666666666666
| "Alice" | "Carol" | "SIMILAR"         | 0.3333333333333333
| "Alice" | "Dave"  | "SIMILAR"         | 1.0
| "Bob"   | "Alice" | "SIMILAR"         | 0.6666666666666666
| "Bob"   | "Dave"  | "SIMILAR"         | 0.6666666666666666
| "Carol" | "Alice" | "SIMILAR"         | 0.3333333333333333
| "Carol" | "Dave"  | "SIMILAR"         | 0.3333333333333333
| "Dave"  | "Alice" | "SIMILAR"         | 1.0
| "Dave"  | "Bob"   | "SIMILAR"         | 0.6666666666666666
| "Dave"  | "Carol" | "SIMILAR"         | 0.3333333333333333
|===
--

==== Multiple properties

[role=query-example]
--
[source, cypher, role=noplay]
----
CALL gds.graph.streamRelationshipProperties('personsAndInstruments', ['score', 'strength'], ['LIKES'])
YIELD
  sourceNodeId, targetNodeId, relationshipType, relationshipProperty, propertyValue
RETURN
  gds.util.asNode(sourceNodeId).name as source, gds.util.asNode(targetNodeId).name as target, relationshipType, relationshipProperty, propertyValue
ORDER BY source ASC, target ASC
----

.Results
[opts="header"]
|===
| source  | target        | relationshipType  | relationshipProperty  | propertyValue
| "Alice" | "Bongos"      | "LIKES"           | "score"               | 3.0
| "Alice" | "Bongos"      | "LIKES"           | "strength"            | 0.5
| "Alice" | "Guitar"      | "LIKES"           | "score"               | 5.0
| "Alice" | "Guitar"      | "LIKES"           | "strength"            | 1.0
| "Alice" | "Synthesizer" | "LIKES"           | "score"               | 4.0
| "Alice" | "Synthesizer" | "LIKES"           | "strength"            | 1.0
| "Bob"   | "Guitar"      | "LIKES"           | "score"               | 4.0
| "Bob"   | "Guitar"      | "LIKES"           | "strength"            | 1.0
| "Bob"   | "Synthesizer" | "LIKES"           | "score"               | 5.0
| "Bob"   | "Synthesizer" | "LIKES"           | "strength"            | 1.0
| "Carol" | "Bongos"      | "LIKES"           | "score"               | 2.0
| "Carol" | "Bongos"      | "LIKES"           | "strength"            | 1.0
| "Dave"  | "Bongos"      | "LIKES"           | "score"               | 5.0
| "Dave"  | "Bongos"      | "LIKES"           | "strength"            | 1.0
| "Dave"  | "Guitar"      | "LIKES"           | "score"               | 3.0
| "Dave"  | "Guitar"      | "LIKES"           | "strength"            | 1.0
| "Dave"  | "Synthesizer" | "LIKES"           | "score"               | 1.0
| "Dave"  | "Synthesizer" | "LIKES"           | "strength"            | 1.0
|===
--


==== Multiple relationship types

[role=query-example]
--
[source, cypher, role=noplay]
----
CALL gds.graph.streamRelationshipProperties('personsAndInstruments', ['score'], ['LIKES', 'SIMILAR'])
YIELD
  sourceNodeId, targetNodeId, relationshipType, relationshipProperty, propertyValue
RETURN
  gds.util.asNode(sourceNodeId).name as source, gds.util.asNode(targetNodeId).name as target, relationshipType, relationshipProperty, propertyValue
ORDER BY source ASC, target ASC
----

.Results
[opts="header"]
|===
| source  | target        | relationshipType  | relationshipProperty  | propertyValue
| "Alice" | "Bob"         | "SIMILAR"         | "score"               | 0.6666666666666666
| "Alice" | "Bongos"      | "LIKES"           | "score"               | 3.0
| "Alice" | "Carol"       | "SIMILAR"         | "score"               | 0.3333333333333333
| "Alice" | "Dave"        | "SIMILAR"         | "score"               | 1.0
| "Alice" | "Guitar"      | "LIKES"           | "score"               | 5.0
| "Alice" | "Synthesizer" | "LIKES"           | "score"               | 4.0
| "Bob"   | "Alice"       | "SIMILAR"         | "score"               | 0.6666666666666666
| "Bob"   | "Dave"        | "SIMILAR"         | "score"               | 0.6666666666666666
| "Bob"   | "Guitar"      | "LIKES"           | "score"               | 4.0
| "Bob"   | "Synthesizer" | "LIKES"           | "score"               | 5.0
| "Carol" | "Alice"       | "SIMILAR"         | "score"               | 0.3333333333333333
| "Carol" | "Bongos"      | "LIKES"           | "score"               | 2.0
| "Carol" | "Dave"        | "SIMILAR"         | "score"               | 0.3333333333333333
| "Dave"  | "Alice"       | "SIMILAR"         | "score"               | 1.0
| "Dave"  | "Bob"         | "SIMILAR"         | "score"               | 0.6666666666666666
| "Dave"  | "Bongos"      | "LIKES"           | "score"               | 5.0
| "Dave"  | "Carol"       | "SIMILAR"         | "score"               | 0.3333333333333333
| "Dave"  | "Guitar"      | "LIKES"           | "score"               | 3.0
| "Dave"  | "Synthesizer" | "LIKES"           | "score"               | 1.0
|===
--


=== Write

==== Relationship type

[role=query-example]
--
[source, cypher, role=noplay]
----
CALL gds.graph.writeRelationship('personsAndInstruments', 'SIMILAR')
YIELD
  graphName, relationshipType, relationshipProperty, relationshipsWritten, propertiesWritten
----

.Results
[opts="header"]
|===
| graphName               | relationshipType | relationshipProperty | relationshipsWritten | propertiesWritten
| "personsAndInstruments" | "SIMILAR"        | null                 | 10                   | 0
|===
--

image::write_relationships_graph.svg[Visualization of the example graph after writing relationships back,align="center"]


==== Relationship type with property

[role=query-example]
--
[source, cypher, role=noplay]
----
CALL gds.graph.writeRelationship('personsAndInstruments', 'SIMILAR', 'score')
YIELD
  graphName, relationshipType, relationshipProperty, relationshipsWritten, propertiesWritten
----

.Results
[opts="header"]
|===
| graphName               | relationshipType | relationshipProperty | relationshipsWritten | propertiesWritten
| "personsAndInstruments" | "SIMILAR"        | "score"              | 10                   | 10
|===
--


=== Delete

[role=query-example]
--
[source, cypher, role=noplay]
----
CALL gds.graph.deleteRelationships('personsAndInstruments', 'SIMILAR')
YIELD
  graphName, relationshipType, deletedRelationships, deletedProperties
----

.Results
[opts="header"]
|===
| graphName               | relationshipType | deletedRelationships | deletedProperties
| "personsAndInstruments" | "SIMILAR"        | 10                   | {score=10}
|===
--
